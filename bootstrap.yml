- hosts: claudinha
  sudo: True
  vars_files:
    - vars/claudinha.yml

  tasks:
  - name: Add user remote
    user:
      name=remote
      password={{ vault_remote_password }}

  - name: Add SSH public key to user remote
    authorized_key:
      user=remote
      key="{{ lookup('file', "files/workstation.pub") }}"

  - name: Add remote user to sudoers
    lineinfile:
      dest=/etc/sudoers
      regexp='^remote ALL'
      line='remote ALL=(ALL) NOPASSWD:ALL'
      state=present

  - name: Disallow root SSH access
    lineinfile:
      dest=/etc/ssh/sshd_config
      regexp="^PermitRootLogin"
      line="PermitRootLogin no"
      state=present
    notify:
      - restart sshd

  - name: Run "apt-get update"
    apt:
      update_cache: yes

  - name: Install "htop" package
    apt:
      name: htop
      state: present

  - name: Install "python3-pip" package
    apt:
      name: python3-pip
      state: present
      install_recommends: no

  - name: Install "python3-dev" package
    apt:
      name: python3-dev
      state: present
      install_recommends: no

  - name: Install "unicornhat" python package
    pip:
      name: unicornhat
      executable: pip3

  - name: Install "bitarray" python package
    pip:
      name: bitarray
      executable: pip3

  - synchronize:
      src: texto/
      dest: prj/claudinha/

  - name: Teste Unicorn Hat
    command: python3 prj/claudinha/ascii_oi.py

  handlers:
  - name: restart sshd
    service:
      name=ssh
      state=restarted